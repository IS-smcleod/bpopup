(function(c){c.fn.bPopup=function(C,G){function O(){a.contentContainer=c(a.contentContainer||b);switch(a.content){case "iframe":var d=c('<iframe class="b-iframe" '+a.iframeAttr+"></iframe>");d.appendTo(a.contentContainer);t=b.outerHeight(!0);u=b.outerWidth(!0);D();d.attr("src",a.loadUrl);v(a.loadCallback);break;case "image":D();c("<img />").load(function(){v(a.loadCallback);H(c(this))}).attr("src",a.loadUrl).hide().appendTo(a.contentContainer);break;default:D(),c('<div class="b-ajax-wrapper"></div>').load(a.loadUrl,
a.loadData,function(b,d){v(a.loadCallback,d);H(c(this))}).hide().appendTo(a.contentContainer)}}function D(){a.modal&&c('<div class="b-modal"></div>').addClass(f).css({backgroundColor:a.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:a.zIndex+w}).appendTo(a.appendTo).fadeTo(a.speed,a.opacity);x();b.data("bPopup",a).data("id",f).css({left:"slideIn"==a.transition||"slideBack"==a.transition?"slideBack"==a.transition?g.scrollLeft()+q:-1*(y+u):l(!(!a.follow[0]&&m||h)),position:a.positionStyle||
"absolute",top:"slideDown"==a.transition||"slideUp"==a.transition?"slideUp"==a.transition?g.scrollTop()+r:z+-1*t:n(!(!a.follow[1]&&p||h)),"z-index":a.zIndex+w+1}).each(function(){a.appending&&c(this).appendTo(a.appendTo)});setTimeout(function(){x();b.data("bPopup",a).data("id",f).css({left:"slideIn"==a.transition||"slideBack"==a.transition?"slideBack"==a.transition?g.scrollLeft()+q:-1*(y+u):l(!(!a.follow[0]&&m||h)),top:"slideDown"==a.transition||"slideUp"==a.transition?"slideUp"==a.transition?g.scrollTop()+
r:z+-1*t:n(!(!a.follow[1]&&p||h))});I(!0)})}function A(){a.modal&&c(".b-modal."+b.data("id")).fadeTo(a.speed,0,function(){c(this).remove()});a.scrollBar||c("html").css("overflow","auto");c(".b-modal."+f).unbind("click");g.unbind("keydown."+f);e.unbind("."+f).data("bPopup",0<e.data("bPopup")-1?e.data("bPopup")-1:null);b.undelegate(".bClose, ."+a.closeClass,"click."+f,A).data("bPopup",null);clearTimeout(J);I();return!1}function K(d){var E={};if(!1===a.animate)x(),b.css({left:l(!(!a.follow[0]&&m||h)),
top:n(!(!a.follow[1]&&p||h))});else if(x(),k=F(),k.x||k.y)clearTimeout(L),L=setTimeout(function(){x();d=d||a.followSpeed;k.x&&(E.left=a.follow[0]?l(!0):"auto");k.y&&(E.top=a.follow[1]?n(!0):"auto");a.animate?b.dequeue().each(function(){h?c(this).css({left:y,top:z}):c(this).animate(E,d,a.followEasing)}):b.css(E)},50)}function H(d){function c(){d.show();k=F()}var f=d.width(),g=d.height(),e={};a.contentContainer.css({height:g,width:f});g>=b.height()&&(e.height=b.height());f>=b.width()&&(e.width=b.width());
t=b.outerHeight(!0);u=b.outerWidth(!0);a.contentContainer.css({height:"auto",width:"auto"});x();e.left=l(!(!a.follow[0]&&m||h));e.top=n(!(!a.follow[1]&&p||h));a.animate?b.animate(e,250,c):(b.css(e),c())}function P(){e.data("bPopup",w);b.delegate(".bClose, ."+a.closeClass,"click."+f,A);a.modalClose&&c(".b-modal."+f).css("cursor","pointer").bind("click",A);M||!a.follow[0]&&!a.follow[1]||e.bind("scroll."+f,function(){var d;if(k.x||k.y)d={},k.x&&(d.left=a.follow[0]?l(!h):"auto"),k.y&&(d.top=a.follow[1]?
n(!h):"auto"),a.animate?b.dequeue().animate(d,a.followSpeed,a.followEasing):b.css(d)}).bind("resize."+f,function(){K()});a.escClose&&g.bind("keydown."+f,function(a){27==a.which&&A()})}function I(d){function c(e){a.animate?b.css({display:"block",opacity:1}).animate(e,a.speed,a.easing,function(){N(d)}):b.css({display:"block",opacity:1}).css(e)}switch(d?a.transition:a.transitionClose||a.transition){case "slideIn":c({left:d?l(!(!a.follow[0]&&m||h)):g.scrollLeft()-(u||b.outerWidth(!0))-B});break;case "slideBack":c({left:d?
l(!(!a.follow[0]&&m||h)):g.scrollLeft()+q+B});break;case "slideDown":c({top:d?n(!(!a.follow[1]&&p||h)):g.scrollTop()-(t||b.outerHeight(!0))-B});break;case "slideUp":c({top:d?n(!(!a.follow[1]&&p||h)):g.scrollTop()+r+B});break;default:b.stop().fadeTo(a.speed,d?1:0,function(){N(d)})}}function N(d){d?(P(),v(G),a.autoClose&&(J=setTimeout(A,a.autoClose))):(b.hide(),v(a.onClose),a.loadUrl&&(a.contentContainer.empty(),b.css({height:"auto",width:"auto"})))}function l(a){return a?y+g.scrollLeft():y}function n(a){return a?
z+g.scrollTop():z}function v(a,e){c.isFunction(a)&&a.call(b,e)}function x(){r=e.height();q=e.width();z=p?a.position[1]:Math.max(0,(r-b.outerHeight(!0))/2-a.amsl);y=m?a.position[0]:(q-b.outerWidth(!0))/2;k=F()}function F(){return{x:q>b.outerWidth(!0),y:r>b.outerHeight(!0)}}var a,g,e,r,q,t,u,p,m,z,y,M,B,b,w,f,k,h,L,J;c.isFunction(C)&&(G=C,C=null);a=c.extend({},c.fn.bPopup.defaults,C);a.scrollBar||c("html").css("overflow","hidden");b=this;g=c(document);e=c(window);r=e.height();q=e.width();M=/OS 6(_\d)+/i.test(navigator.userAgent);
B=200;w=0;b.close=function(){A()};b.reposition=function(a){K(a)};return b.each(function(){c(this).data("bPopup")||(v(a.onOpen),w=(e.data("bPopup")||0)+1,f="__b-popup"+w+"__",p="auto"!==a.position[1],m="auto"!==a.position[0],h="fixed"===a.positionStyle,t=b.outerHeight(!0),u=b.outerWidth(!0),a.loadUrl?O():D())})};c.fn.bPopup.defaults={animate:!0,amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",
followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}})(jQuery);
